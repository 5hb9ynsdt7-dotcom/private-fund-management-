# 更新日志

所有重要的项目变更都将记录在此文件中。

本文档格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
并且本项目遵循 [语义化版本控制](https://semver.org/lang/zh-CN/)。

## [1.0.0] - 2025-01-19

### 🎉 首次发布

私募基金管理系统正式发布，这是一个功能完整的基金管理平台。

### ✨ 新增功能

#### 核心业务模块
- **净值管理**
  - Excel文件上传基金净值数据
  - 净值历史记录查询和展示
  - 支持多种日期格式解析 (YYYY-MM-DD, YYYY-MM-DD HH:MM:SS, YYYYMMDD)
  - 净值数据验证和错误处理

- **策略管理** 
  - 投资策略配置 (大类策略/细分策略)
  - QD产品标识管理
  - 批量策略编辑功能
  - 策略数据导入导出

- **持仓分析**
  - 客户持仓数据管理
  - 持有收益计算 (考虑现金分红)
  - 阶段收益分析 (智能处理买入时间)
  - 今年以来收益统计
  - 策略分布可视化 (ECharts饼图)

- **分红管理**
  - 现金分红记录管理
  - 红利转投数据处理
  - 分红对收益影响的准确计算

- **交易分析** (预留)
  - 资金流向分析框架
  - 客户活跃度统计接口
  - 基金表现评估功能

#### 数据处理能力
- **Excel文件处理**
  - 支持 .xlsx 格式文件上传
  - 智能字段映射 (中文列名自动识别)
  - 数据验证和清洗
  - 错误数据提示和跳过

- **收益计算引擎**
  - 持有收益 = 最新市值 - 成本(含费) - 现金分红
  - 阶段收益智能计算：
    - 买入时间在阶段内：使用买入净值作为期初净值
    - 买入时间在阶段前：使用阶段开始日净值作为期初净值
  - 今年以来收益与阶段收益逻辑一致性

#### 用户界面功能
- **持仓详情页面**
  - 收益概览卡片 (总投资、总市值、累计盈亏、今年以来收益)
  - 持仓分布、策略分布图表
  - 按策略分组的持仓明细表
  - 阶段收益时间范围选择
  - QD产品标识显示

- **表格功能**
  - 策略分组和小计行
  - 阶段收益小计和总计
  - 响应式列宽设计
  - 数据排序和筛选

- **数据可视化**
  - ECharts饼图 (持仓分布、大类策略、细分策略)
  - 图表数值格式化 (千分位分隔符)
  - 动态数据绑定

### 🔧 技术实现

#### 后端架构
- **FastAPI** 框架提供 RESTful API
- **SQLAlchemy** ORM 数据库操作
- **SQLite** 数据库存储
- **Pandas** 数据处理和分析
- **Pydantic** 数据验证和序列化

#### 前端架构  
- **Vue 3** + Composition API
- **Element Plus** UI 组件库
- **ECharts** 数据可视化
- **Axios** HTTP 客户端
- **Vue Router 4** 单页应用路由

#### 数据库设计
- **Fund** (基金表): 基金基本信息
- **Strategy** (策略表): 投资策略配置
- **Nav** (净值表): 基金净值历史
- **Client** (客户表): 客户基本信息  
- **Position** (持仓表): 客户持仓记录
- **ClientDividend** (分红表): 客户分红记录

### 🐛 已修复问题

#### 日期处理问题
- 修复日期格式解析错误 (支持带时间的日期格式)
- 统一存量时间和首次买入日期的处理逻辑
- 修复页面标题日期显示错误

#### 收益计算问题  
- 修复现金分红计算逻辑错误
- 统一今年以来收益与阶段收益计算方法
- 修复持有收益未扣除分红的问题

#### 界面显示问题
- 修复今年以来收益显示单位 (% → 元)
- 优化饼图标签格式 (去除小数点、添加千分位分隔符)
- 修复QD标识显示样式问题
- 优化表格宽度适配

### 🚀 性能优化

- 数据库查询优化 (减少N+1查询)
- 前端图表渲染优化
- Excel文件处理性能提升
- 数据库 VACUUM 优化存储空间

### 🧹 代码清理

- 删除未使用的依赖 (pinia)
- 清理冗余代码和注释
- 优化数据库文件管理
- 统一代码风格和规范

### 📋 API接口

#### 持仓分析 API
- `GET /api/position/clients` - 获取客户列表
- `GET /api/position/clients/{group_id}` - 获取客户持仓详情
- `POST /api/position/upload` - 上传持仓数据

#### 净值管理 API  
- `GET /api/nav/list` - 获取净值列表
- `POST /api/nav/upload` - 上传净值数据
- `POST /api/nav/manual` - 手动添加净值

#### 策略管理 API
- `GET /api/strategy/list` - 获取策略列表  
- `POST /api/strategy/upload` - 上传策略数据
- `PUT /api/strategy/batch-edit` - 批量编辑策略

#### 分红管理 API
- `GET /api/dividend/list` - 获取分红列表
- `POST /api/dividend/upload` - 上传分红数据

### 📝 已知限制

- 数据库使用SQLite，不适合大规模并发
- 文件上传大小限制为10MB
- 暂未实现用户权限管理
- 交易分析功能为预留接口

### 📦 部署支持

- Docker容器化配置
- 环境变量配置支持
- 生产环境优化配置

---

## 版本比较链接

[1.0.0]: https://github.com/example/privatefund/releases/tag/v1.0.0